<!--
    IzPack Installation Script for openXdata
    Authour: Ronald.K
-->
<!DOCTYPE root-element SYSTEM "installation.dtd"> 
<installation version="1.0">

    <!-- The info section -->
    <info>
        <appname>openXdata</appname>
        <appversion>@version@</appversion>
        <authors>
            <author email="" name="openXdata Team"/>
            <author email="" name="University of Makerere (Uganda)"/>
            <author email="" name="University of Bergen (Norway)"/>
            <author email="" name="Interactive Research and Development (Pakistan)"/>
            <author email="" name="Handheld Solutions and Research Labs (India)"/>
            <author email="" name="Zegeba Technology (Norway)  "/>
            <author email="" name="University of Southern Maine (USA)  "/>
            <author email="" name="Cell-Life (South Africa) "/>
        </authors>
        <url>http://www.openXdata.org/</url>
        <javaversion>1.6</javaversion>
        <uninstaller name="uninstall" path="$INSTALL_PATH/uninstaller"/>
        <requiresjdk>no</requiresjdk>
        <!-- <pack200/> -->
        <run-privileged condition="izpack.windowsinstall.vista|izpack.windowsinstall.7"/>
        <summarylogfilepath>$INSTALL_PATH/installinfo/Summary.htm</summarylogfilepath>
    </info>

    <variables>
        <variable name="DesktopShortcutCheckboxEnabled" value="true"/>
        <variable name="ApplicationShortcutPath"        value="ApplicationShortcuts" />
        <variable name="data.validation.error.title"        value="Error" />
        <!--Disable Showing Create Directory Message on User Input Panel-->
        <variable name="ShowCreateDirectoryMessage"     value="false"/>

        <!-- Super user login credentials for external mysql server-->
        <variable name="mysql.username"                 value="root"/>
        <variable name="mysql.password.user"            value=""/>
        <variable name="mysql.host"                     value="localhost"/>

        <!-- Root password to set embedded MySqlServer -->
        <variable name="mysql.root.password"            value=""/>

        <!-- Login credentials MySql server for oxd -->
        <variable name="mysql.openxdata.username"       value="oxduser"/>
        <variable name="mysql.openxdata.password"       value=""/>
        <variable name="mysql.openxdata.dbname"         value="openxdata"/>

        <!-- Tomcat directory user selects -->
        <variable name="tomcat.dir.user"                value=""/>

        <!-- Ports -->
        <variable name="tomcat.port"                    value="8080"/>
        <variable name="mysql.port"                     value="3306"/>
        <variable name="tomcat.shutdown.port"          value="8005"/>

        <!-- Users for embeded tomcat server -->
        <variable name="tomcat.admin.user"              value="admin"/>
        <variable name="tomcat.admin.password"          value="admin"/>

        <variable name="setup.type"                     value="standard"/>

        <!--
        general.password is used in the case of standard installation
        for tomacat and mysql root user
        -->
        <variable name="general.password"               value=""/>
    </variables>

    <dynamicvariables>
        <!-- Tomcat directory in which to install tomcat -->
        <variable name="tomcat.dir"  value     ="${INSTALL_PATH}/Tomcat6.0"
                  condition ="izpack.selected.Tomcat6"/>
        <variable name="tomcat.dir"  value     ="${tomcat.dir.user}"
                  condition ="!izpack.selected.Tomcat6"/>

        <!-- Root password to login into the sql server -->
        <variable name="mysql.password"  value ="pass"
                  condition ="izpack.selected.MySql"/>
        <variable name="mysql.password"  value ="${mysql.password.user}"
                  condition ="!izpack.selected.MySql"/>

        <variable name="mysql.selected.comment" value="--"
                  condition="!izpack.selected.MySql"/>
        <variable name="mysql.selected.comment" value=""
                  condition="izpack.selected.MySql"/>

        <variable name="mysql.script.comment" value="rem"
                  condition="!izpack.selected.MySql"/>
        <variable name="mysql.script.comment" value=""
                  condition="izpack.selected.MySql"/>

        <variable name="mysql.openxdata.password.dy" value="${mysql.openxdata.password}"
                  condition="expertinstallation"/>
        <variable name="mysql.openxdata.password.dy" value="${general.password}"
                  condition="standardinstallation"/>

        <variable name="tomcat.admin.password.dy" value="${tomcat.admin.password}"
                  condition="expertinstallation"/>
        <variable name="tomcat.admin.password.dy" value="${general.password}"
                  condition="standardinstallation"/>

        <variable name="mysql.root.password.dy"  value="${mysql.root.password}"
                  condition="expertinstallation"/>
        <variable name="mysql.root.password.dy" value="${general.password}"
                  condition="standardinstallation"/>

        <variable name="packs.required"   value="yes"
                  condition="standardinstallation"/>
        <variable name="packs.required"    value="no"
                  condition="expertinstallation"/>

        <variable name="xp.comment" value=""
                  condition="xpinstallation"/>
        <variable name="xp.comment" value="rem"
                  condition="!xpinstallation"/>


        <variable name="vista.comment" value=""
                  condition="vistainstallation"/>
        <variable name="vista.comment" value="rem"
                  condition="!vistainstallation"/>
    </dynamicvariables>

    <!-- Conditions -->
    <conditions>

        <condition type="variable" id="standardinstallation">
            <name>setup.type</name>
            <value>standard</value>
        </condition>

        <condition type="variable" id="expertinstallation">
            <name>setup.type</name>
            <value>expert</value>
        </condition>

        <condition type="or" id="xpinstallation">
        <condition type="ref" refid="izpack.windowsinstall.xp"/>
        <condition type="ref" refid="izpack.windowsinstall.2003"/>
        </condition>

        <condition type="or" id="vistainstallation">
        <condition type="ref" refid="izpack.windowsinstall.vista"/>
        <condition type="ref" refid="izpack.windowsinstall.7"/>
        </condition>

    </conditions>

    <guiprefs height="550" resizable="yes" width="700">

        <modifier key="layoutAnchor"           value="CENTER"/>
        <modifier key="showDebugWindow"        value="true"/>
        <modifier key="headingPanelCounterPos" value="inNavigationPanel"/>
        <modifier key="allYGap"                value="4"/>
        <modifier key="paragraphYGap"          value="10"/>
        <modifier key="filler1YGap"            value="5"/>
        <modifier key="filler3XGap"            value="10"/>

    </guiprefs>

    <!-- Lunguage Pack -->
    <locale>
        <langpack iso3="eng"/>
    </locale>

    <!-- The resources needed by the various panels -->
    <resources>

        <res id="HTMLInfoPanel.info"        src="install-readme.html" />
        <res id="HTMLLicencePanel.licence"  src="license.html" />
        <!--<res id="installer.langsel.img"     src="splash-3.10.png" />-->
        <res id="shortcutSpec.xml"          src="specs/shortcutSpec.xml" />
        <res id="userInputSpec.xml"         src="specs/inputSpec.xml" parsexml="yes"/>
        <res id="ProcessPanel.Spec.xml"     src="specs/processPanelSpec.xml"/>
        <res id="Installer.image"           src="images/openXdata-border.png"/>
        <res id="RegistrySpec.xml"          src="specs/registrySpec.xml" />
    </resources>

    <panels>
        <panel classname="CheckedHelloPanel" id="hellopanel"/>

        <panel classname="HTMLLicencePanel"  id="licensepanel"/>

        <panel classname="TargetPanel"       id="targetpanel" />

        <panel classname="UserInputPanel"    id="install.type.panel"/>

        <panel classname="UserInputPanel"    id="standard.input"
               condition="standardinstallation"/>

        <panel classname="PacksPanel"        id="packspanel"
               condition="expertinstallation"/>

        <panel classname="UserInputPanel"    id="openXdata.mysql.panel"
               condition="izpack.selected.MySql+expertinstallation"/>

        <panel classname="UserInputPanel"    id="MySql.panel"
               condition ="!izpack.selected.MySql">
            <validator classname="org.openxdata.mak.izpack.validator.JDBCValidator" />
        </panel>

        <panel classname="UserInputPanel"    id="openXdata.tomcat.panel"
               condition="izpack.selected.Tomcat6+expertinstallation"/>

        <panel classname="UserInputPanel"    id="Tomcat.panel"
               condition ="!izpack.selected.Tomcat6">
            <validator classname="org.openxdata.mak.izpack.validator.TomcatSelectionValidator"/>
        </panel>

        <panel classname="SummaryPanel"     id="summarypanel"
               condition="expertinstallation"/>

        <panel classname="InstallPanel"     id="installpanel"/>

        <panel classname="ProcessPanel"/>

        <panel classname="ShortcutPanel"     id="shortcutpanel"/>

        <panel classname="FinishPanel"       id="finishpanel"/>
    </panels>

    <listeners>
        <!--<listener installer="SummaryLoggerInstallerListener"/>-->
        <listener installer="RegistryInstallerListener"
                  uninstaller="RegistryUninstallerListener">
            <os family="windows"/>
        </listener>
    </listeners>


    <packs>
        <!-- The core files pack -->
        <pack name="openXdata" required="yes" >

            <description>The openXdata core files.</description>

            <file src="lib/uninstall.exe" targetdir="$INSTALL_PATH/uninstaller"/>
            <fileset dir="" targetdir="$INSTALL_PATH" override="true">
                <include name="script/**/*"/>
                <include name="*.txt"/>
                <include name="openXdata_Logo.ico"/>
                <include name="version"/>
                <exclude name="script/update.bat"/>
            </fileset>

            <!--  openXdata directory copied into tomcat directry -->
            <fileset dir="" targetdir="$tomcat.dir/webapps" casesensitive="yes" override="true">
                <include name="openXdata/**/*"/>
            </fileset>

            <parsable targetfile="$tomcat.dir/webapps/openXdata/OPENXDATA_SETTINGS.properties" type="javaprop"/>
            <parsable targetfile="$INSTALL_PATH/script/uninstall-tomcat-service.bat" type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/tomcat-service.bat" type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/install-tomcat-service.bat" type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/install-mysql-service.bat" type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/uninstall-mysql-service.bat" type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/import-db.bat" type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/setupenvironment.bat"  type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/startUp.bat" type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/oxdservice.bat" type="shell"/>
            <parsable targetfile="$INSTALL_PATH/script/create-database.sql" type="plain"/>
            <parsable targetfile="$INSTALL_PATH/script/elevator.bat" type="shell"/>

            <executable targetfile="$INSTALL_PATH/script/uninstall-tomcat-service.bat" stage="uninstall" >
                <os family="windows"/>
            </executable>
        </pack>

        <!-- MySql Server pack -->
        <pack name="MySql" required="no">
            <description>
                The database to store all data.Unless you already have MySql installed and want to intergrate openXdata into your already existing MySql server then you can uncheck MySql, Setup will ask for the connection parameters to import into your already existing MySql server.

                Leave package selected to install the bundled mysql.
            </description>

            <file src="thirdparty/mysql5.zip" targetdir="$INSTALL_PATH" unpack="true"/>

            <parsable   targetfile="$INSTALL_PATH/mysql5/my.ini" type="plain" />

            <executable targetfile="$INSTALL_PATH/script/uninstall-mysql-service.bat" stage="postinstall" keep="true">
                <os family="windows"/>
            </executable>

            <executable targetfile="$INSTALL_PATH/script/uninstall-mysql-service.bat" stage="uninstall" keep="true">
                <os family="windows"/>
            </executable>
        </pack>

        <!-- Tomcat Server pack -->
        <pack name="Tomcat6" required="no" >
            <description>
                Webserver to run openXdata.Unless you already have Tomcat Installed and want to intergrate openXdata into your already existing Tomcat server then you can uncheck Tomcat.
                Setup will ask for the directory in which tomcat is installed.

                Leave package selected to install the bundled tomcat.
            </description>

            <file src="thirdparty/Tomcat6.0.zip" targetdir="$INSTALL_PATH" unpack="true"/>
            <file src="thirdparty/msvcr71.dll" targetdir="$tomcat.dir/bin" />

            <parsable targetfile="$tomcat.dir/conf/server.xml" type="xml"/>
            <parsable targetfile="$tomcat.dir/bin/service.bat" type="shell"/>
            <parsable targetfile="$tomcat.dir/conf/tomcat-users.xml" type="xml"/>

            <executable targetfile="$INSTALL_PATH/script/uninstall-tomcat-service.bat" stage="postinstall" keep="true">
                <os family="windows"/>
            </executable>

            <executable targetfile="$INSTALL_PATH/script/uninstall-tomcat-service.bat" stage="uninstall" keep="true">
                <os family="windows"/>
            </executable>
        </pack>
    </packs>

    <jar src="../openXdata-installer.jar" stage="install" />
    <jar src="lib/mysql-connector-java-5.0.4.jar" stage="install"/>

    <!-- The native libraries to add -->
    <native type="izpack"   name="ShellLink.dll"/>
    <native type="izpack"   name="ShellLink_x64.dll"/>

    <native type="3rdparty" name="COIOSHelper.dll" stage="both">
        <os family="windows"/>
    </native>
</installation>